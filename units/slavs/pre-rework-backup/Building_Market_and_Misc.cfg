#textdomain wesnoth-units
[unit_type]
    id=Slav_Marketplace
#ifdef OGRE_RUSSIAN
    name= _"Рынок"
#else
    name= _ "Marketplace"
#endif
    race=mechanical
    image="units/buildings/market.png"
    hitpoints=50
    movement_type=slav_building
    movement=0
    attacks=0
    vision=3
    experience=50
    level=1
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=20
    usage=building
    [abilities]
    {ABILITY_STEPPE_BUILDING}
    [dummy]
        id=steppe_marketplace
        {TRANSLATE_ABILITY "marketplace" "рынок"}
        {TRANSLATE_DESCRIPTION _"Each turn, this unit generates gold and reduces upkeep like one village." _"Каждый ход, этот юнит производит золото и погашает содержание как одна деревня."}
    [/dummy]
#    {ABILITY_STEPPE_REGENERATES 4}
    [/abilities]
    [resistance]
        fire=130
    [/resistance]
    [event]
    name=unit placed
    first_time_only=no
    id=steppe_marketvariables
    [filter]
       ability=steppe_marketplace
    [/filter]
    #the condition filter is needed to prevent recursion, as [unit_overlay] triggers the unit placed event
    [filter_condition]
    {VARIABLE_CONDITIONAL tmp_steppe_antiloop not_equals yes}
    [/filter_condition]

    [store_side]
        side=$side_number
        variable=steppe_marketside
    [/store_side]
    {VARIABLE unit.variables.income $steppe_marketside.village_gold}
    {VARIABLE unit.upkeep -$steppe_marketside.village_support}

#just in case a scenario has village income set to 1
    {IF_VAR unit.variables.income greater_than 0 (
    [else]
    {VARIABLE unit.variables.income 1}
    [/else]
    )}

    [unstore_unit]
        variable=unit
        find_vacant=no
    [/unstore_unit]

    {CLEAR_VARIABLE steppe_marketside}
    {CLEAR_VARIABLE tmp_steppe_antiloop}
    [/event]

    [event]
        name=side turn
        id=steppe_marketincome
        first_time_only=no
    [store_unit]
        [filter]
            ability=steppe_marketplace
            side=$side_number
        [not]
        [filter_wml]
        [status]
            petrified=yes
        [/status]
        [/filter_wml]
        [/not]
        [/filter]
        variable=steppe_market
        kill=no
    [/store_unit]
    [if]
    [variable]
        name=steppe_market.length
        greater_than=0
    [/variable]
    [then]
    [store_side]
        side=$side_number
        variable=steppe_marketside
    [/store_side]
    {FOREACH steppe_market i}
    [scroll_to]
        x,y=$steppe_market[$i].x,$steppe_market[$i].y
    [/scroll_to]
            [store_gold]
                side=$side_number
                variable=currentgold
            [/store_gold]
    {VARIABLE steppe_market.variables.income $steppe_marketside.village_gold}
    {VARIABLE steppe_market.upkeep -$steppe_marketside.village_support}

#just in case a scenario has village income set to 1
    {IF_VAR steppe_market.variables.income greater_than 0 (
    [else]
    {VARIABLE steppe_market.variables.income 1}
    [/else]
    )}

    [gold]
        side=$side_number
        amount=$steppe_market.variables.income
    [/gold]
    [sound]
      name=gold.ogg
    [/sound]
        [unstore_unit]
            variable=steppe_market[$i]
            text="$steppe_market.variables.income|g"
            red=255
            green=255
            blue=0
            find_vacant=no
        [/unstore_unit]
    [delay]
       time=100
    [/delay]
    {NEXT i}
    {CLEAR_VARIABLE steppe_market}
    [/then]
    [/if]
    {CLEAR_VARIABLE currentgold}
    {CLEAR_VARIABLE steppe_marketside}
    [/event]
[/unit_type]

[unit_type]
    id=Slav_Healing_Tent
#ifdef OGRE_RUSSIAN
    name= _"Лечебная Палатка"
#else
    name= _ "Healing Tent"
#endif
    race=mechanical
    image="units/buildings/healing-tent.png"
    hitpoints=25
    movement_type=slav_building
    movement=0
    attacks=0
    vision=3
    experience=50
    level=0
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=9
    usage=building
    [abilities]
    {ABILITY_STEPPE_BUILDING}
    {ABILITY_STEPPE_CURES 6}
    [/abilities]
[/unit_type]

[unit_type]
    id=Slav_Watchtower
#ifdef OGRE_RUSSIAN
    name= _"Сторожевая Вышка"
#else
    name= _ "Watchtower"
#endif
    race=mechanical
    image="units/buildings/watchtower.png"
    hitpoints=25
    movement_type=slav_building
    movement=0
    attacks=0
    vision=9
    experience=50
    level=0
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=7
    usage=building
    [abilities]
    {ABILITY_STEPPE_BUILDING}
    [/abilities]
[/unit_type]

[unit_type]
    id=Slav_Teleporter
#ifdef OGRE_RUSSIAN
    name= _ "Телепортер"
#else
    name= _ "Teleporter"
#endif
    race=mechanical
    image="scenery/summoning-center.png"
    halo=halo/elven/shyde-stationary-halo[1~6].png:150
    hitpoints=30
    movement_type=slav_building
    movement=0
    attacks=0
    vision=3
    experience=100
    level=0
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=18
    usage=wall
    [abilities]
    {ABILITY_STEPPE_BUILDING}
    [dummy]
        id=buildings_teleporter
        {TRANSLATE_ABILITY "teleporter" "телепортер"}
        {TRANSLATE_DESCRIPTION _"This unit allows allies to freely teleport between it and other teleporters. Requires at least two teleporters to work." _"Союзники могут сводобно телепортировать между этим и другими союзными телепортерами. Нужны хотя бы два телепортера чтобы это работало."}
    [/dummy]
    [/abilities]
    [resistance]
        arcane=120
        pierce=80
        blade=80
        cold=70
        impact=80
        fire=70
    [/resistance]
    [event]
    name=side turn
    id=steppe_teleporterevent
    first_time_only=no
    [tunnel]
    id=teleporter
    remove=no
    [filter]
       side=$side_number
    [/filter]
    [source]
    radius=1
    [filter]
       ability=buildings_teleporter
    [filter_side]
    [ally_of]
       side=$side_number
    [/ally_of]
    [/filter_side]
    [/filter]
    [/source]
    [target]
    radius=1
    [filter]
       ability=buildings_teleporter
       side=$side_number
    [filter_side]
    [ally_of]
       side=$side_number
    [/ally_of]
    [/filter_side]
    [/filter]
    [/target]
    [/tunnel]
    [/event]
[/unit_type]

[unit_type]
    id=Slav_Library
#ifdef OGRE_RUSSIAN
    name= _ "Библиотека"
#else
    name= _ "Library"
#endif
    race=mechanical
    image="units/buildings/library.png"
    hitpoints=35
    movement_type=slav_building
    movement=0
    attacks=0
    vision=3
    experience=100
    level=1
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=14
    usage=wall
    [abilities]
    {ABILITY_STEPPE_BUILDING}
    [dummy]
        id=buildings_library
        {TRANSLATE_ABILITY "library" "библиотека"}
        {TRANSLATE_DESCRIPTION _"Each turn, this unit gives adjacent allies +2 experience." _"Каждый ход, этот юнит дает стоящим рядом союзникам +2 опыта."}
    [/dummy]
    [/abilities]
    [event]
        name=side turn
        id=steppe_library
        first_time_only=no
    [store_unit]
        [filter]
            ability=buildings_library
            side=$side_number
        [not]
        [filter_wml]
        [status]
            petrified=yes
        [/status]
        [/filter_wml]
        [/not]
        [/filter]
        variable=steppe_library
        kill=no
    [/store_unit]
    [if]
    [variable]
        name=steppe_library.length
        greater_than=0
    [/variable]
    [then]
    [store_side]
        side=$side_number
        variable=steppe_libraryside
    [/store_side]
    {FOREACH steppe_library i}
    [scroll_to]
        x,y=$steppe_library[$i].x,$steppe_library[$i].y
    [/scroll_to]

    [store_unit]
        [filter]
            [filter_side]
            [allied_with]
                side=$side_number
            [/allied_with]
            [/filter_side]
            [filter_adjacent]
                x,y=$steppe_library[$i].x,$steppe_library[$i].y
            [/filter_adjacent]
        [not]
        [filter_wml]
        [status]
            petrified=yes
        [/status]
        [/filter_wml]
        [/not]
        [/filter]
        variable=steppe_library_units
        kill=no
    [/store_unit]

    {FOREACH steppe_library_units e}

    {VARIABLE_OP steppe_library_units[$e].experience add 2}

    [unstore_unit]
        variable=steppe_library_units[$e]
#ifdef OGRE_RUSSIAN
        text="+2 опыта"
#else
        text="+2 exp"
#endif
#        red=0
#        green=0
#        blue=255
        find_vacant=no
    [/unstore_unit]

    {NEXT e}

    {NEXT i}
    {CLEAR_VARIABLE steppe_library}
    {CLEAR_VARIABLE steppe_library_units}
    [/then]
    [/if]
    [/event]
[/unit_type]

[unit_type]
    id=Slav_Hiding_Spot
#ifdef OGRE_RUSSIAN
    name= _ "Укрытие"
#else
    name= _ "Hiding Spot"
#endif
    race=mechanical
    image="units/buildings/hiding-spot.png"
    hitpoints=30
    movement_type=slav_building
    movement=0
    attacks=0
#    vision=3
    experience=100
    level=0
    alignment=neutral
    advances_to=null
    {AMLA_DEFAULT}
    cost=10
    usage=wall
    [abilities]
    {ABILITY_STEPPE_BUILDING}
    [hides]
        id=building_hiding_spot
        {TRANSLATE_ABILITY_HIDES "hiding spot" "укрытие"}
        {TRANSLATE_DESCRIPTION  _"This unit makes adjacent non-building allies invisible." _"Этот юнит делает стоящих рядом союзников (кроме зданий) невидимыми."}
        affect_self=no
        affect_allies=yes
        [filter]
        [/filter]
        [affect_adjacent]
            [filter]
                [not]
                    ability=steppe_building
                [/not]
            [/filter]
        [/affect_adjacent]
    [/hides]
    [/abilities]
[/unit_type]