#textdomain wesnoth-units

#define SPECIAL_NOTES_STEPPE_AMLA
#ifdef OGRE_RUSSIAN
_" Этот юнит имеет свои AMLA апгрейды."
#else
_" This unit has custom AMLA upgrades."
#endif
#enddef

#note to self: abilities with events inside them don't work with [effect] - the events need to be moved into the eventloader for them to work

#define STEPPE_ADVANCEMENT ID DESCR RUSDESCR IMAGE PARAMS
    [advancement]
        id={ID}
#ifdef OGRE_RUSSIAN
        description={RUSDESCR}
#else
        description={DESCR}
#endif
        image={IMAGE}
        {PARAMS}
        [effect]
            apply_to=hitpoints
            heal_full=yes
        [/effect]
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/advancement]
#enddef

#define STEPPE_ADVANCEMENT_FILTERED ID DESCR RUSDESCR IMAGE FILTER PARAMS
    [advancement]
        id={ID}
#ifdef OGRE_RUSSIAN
        description={RUSDESCR}
#else
        description={DESCR}
#endif
        image={IMAGE}
        [filter]
        {FILTER}
        [/filter]
        {PARAMS}
        [effect]
            apply_to=hitpoints
            heal_full=yes
        [/effect]
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/advancement]
#enddef 

#define STEPPE_ADVANCEMENT_BUILDOPTION AMLA_ID DESCR RUSDESCR IMAGE ID DESCRIPTION RUSDESCRIPTION COST UNIT MOVESCOST EFFECTS
    [advancement]
        id={AMLA_ID}
#ifdef OGRE_RUSSIAN
        description={RUSDESCR}
#else
        description={DESCR}
#endif
        image={IMAGE}
        {EFFECTS}
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDOPTION {ID} {DESCRIPTION} {RUSDESCRIPTION} {COST} {UNIT} {MOVESCOST}}
            [/abilities]
        [/effect]
        [effect]
            apply_to=hitpoints
            heal_full=yes
        [/effect]
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/advancement]
#the event is placed inside the unit file itself
    {BUILDOPTION_EVENT {ID} {DESCRIPTION} {RUSDESCRIPTION} {COST} {UNIT} {MOVESCOST}}
#enddef

#define EVENTLOADER_EVENTS_AMLA
[event]
    name=post advance
    id=steppe_slave_citizenship
    first_time_only=no
    [filter]
      ability=steppe_slave
      [not]
         ability=wasslave #don't apply citizenship to recruitable slaves, as they already have something similar on lvl2
      [/not]
    [/filter]

#check if advances_to is a null value, using a nonexistent variable to achieve the result:
    {IF_VAR unit.advances_to equals $tmp_steppe_emptyvariable (
    [then]

#    [chat]
#        message="citizen amla event triggered"
#    [/chat]

    [object]
        silent=yes
        duration=forever
        [filter]
            find_in=unit
        [/filter]
        [effect]
            apply_to=new_advancement
{STEPPE_ADVANCEMENT khaganatecitizen _"Khaganate Citizenship: the unit is no longer a slave, and becomes a khaganate unit, +15% damage, and loyal trait, +20% XP" _"Каганатское Гражданство: юнит теперь не раб, а каганатский юнит, +15% урон, получает трейт 'верный', +20% ОП" faction-icons/khaganate.png (
        strict_amla=yes
        max_times=1
        [filter]
            ability=steppe_slave #this is so the AMLA can't be selected if the unit is freed under rare specific conditions
        [/filter]
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_STEPPE_SLAVE}
                {ABILITY_WASLEADER}
            [/abilities]
        [/effect]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_KHAGANATEFACTION}
			[/abilities]
		[/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=attack
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
    [/effect]
    [/object]

    [/then])}
[/event]
[event]
    name=post advance
    id=steppe_slave_citizenship2
    first_time_only=no
    [filter]
      ability=steppe_loyaltrait
    [/filter]

#    [chat]
#        message="citizen amla post advance triggered"
#    [/chat]

    [object]
        silent=yes
        duration=forever
        [filter]
            find_in=unit
        [/filter]
		[effect]
			apply_to=remove_ability
			[abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
			[/abilities]
		[/effect]
    [/object]

    [modify_unit]
        [filter]
            id=$unit.id
        [/filter]
        {TRAIT_LOYAL}
    [/modify_unit]

    [unit_overlay]
        id=$unit.id
        image=misc/loyal-icon.png
    [/unit_overlay]

    [remove_unit_overlay]
        id=$unit.id
        image="misc/hero-icon-old.png~CS(-101,-101,-101)"
    [/remove_unit_overlay]
[/event]

[event]
    name=post advance
    id=steppe_khagan_canrecruit
    first_time_only=no
    [filter]
      ability=steppe_khagan_canrecruit
    [/filter]

    {MODIFY_UNIT id=$unit.id canrecruit yes}

[/event]
[event]
    name=pre advance
    id=steppe_khagan_canrecruit2
    first_time_only=no
    [filter]
      type=Khaganate_Serpenthead_Khagan
    [/filter]

#    [chat]
#      message="khagan canrecruit event triggered"
#    [/chat]

    {IF_VAR unit.canrecruit equals yes (
    [then]

#remove the canrecruit advancement if the unit can already recruit
    [object]
        silent=yes
        duration=turn #duration is only one turn, just in case the unit loses his leadership somehow, like through another add-on
        [filter]
            find_in=unit
        [/filter]
        [effect]
            apply_to=remove_advancement
            amlas=canrecruit
        [/effect]
    [/object]

    [/then]
    )}
[/event]
[event]
    name=pre advance
    id=steppe_sentinel_leadership
    first_time_only=no
    [filter]
      type=Khaganate_Sentinel,Khaganate_Marksman
    [/filter]

    {IF_VAR unit.variation equals freed (
    [then]

    [object]
        silent=yes
        duration=turn #duration is only one turn, just in case the unit's variation changes
        [filter]
            find_in=unit
        [/filter]
        [effect]
            apply_to=remove_advancement
            amlas=oversight
        [/effect]
    [/object]

    [/then]
    [else]

    [object]
        silent=yes
        duration=turn #duration is only one turn, just in case the unit's variation changes
        [filter]
            find_in=unit
        [/filter]
        [effect]
            apply_to=remove_advancement
            amlas=lesser_leadership
        [/effect]
    [/object]

    [/else]
    )}
[/event]
#enddef

#define STEPPE_AMLA_HP
{STEPPE_ADVANCEMENT steppe_hp _"+5 Max Hp, +20% XP" _"+5 Макс. ЗД, +20% ОП" icons/amla-default.png (
        strict_amla=yes
        max_times=100
        [effect]
            apply_to=hitpoints
            increase_total=5
        [/effect]        
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Bull Tumen AMLAs:

#define STEPPE_AMLA_CHARIOT
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT melee_damage _"+15% melee damage, +20% XP" _"+15% ближний урон, +20% ОП" attacks/axe-crude.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT linebreaker _"Linebreaker: trample gains stun special, +20% XP" _"Пролом линии: атака растаптыванием получает способоность оглушение, +20% ОП" attacks/kick-horse.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=trample
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_STUN}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT spear_damage _"+2 spear damage, +20% XP" _"+2 урон копьем, +20% ОП" attacks/javelin-orcish.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=spear
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_BULL
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+15% melee damage, +20% XP" _"+15% ближний урон, +20% ОП" attacks/horn.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT regeneration _"lesser regenerates +6 is replaced by normal regenerates, +15% XP" _"низшая регенерация +6 заменена обычной, +15% ОП" icons/heal-royal-1.png (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=remove_ability
			[abilities]
				{ABILITY_STEPPE_REGENERATES_LESSER 6}
			[/abilities]
		[/effect]
		[effect]
			apply_to=new_ability
			[abilities]
                {ABILITY_REGENERATES}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT movement _"+1 moves, +20% XP" _"+1 ход, +15% ОП" attacks/kick-horse.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=movement
            increase=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT drain _"Ritual Bull: 8-1 cold ranged magical drain attack, +20% XP" _"Ритуальный Бык: 8-1 холодная дальняя магическая атака с высасыванием, +20% ОП" attacks/blood-magic-1.png (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=new_attack
#note: [attack] tags are not needed when adding attacks via effect
        name=drain
        {TRANSLATE_ATTACK _"drain life" "высасывание жизни"}
        icon=attacks/blood-magic-1.png
        type=cold
        range=ranged
        damage=8
        number=1
        [specials]
            {WEAPON_SPECIAL_MAGICAL}
            {WEAPON_SPECIAL_DRAIN}
        [/specials]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT drain_damage _"+4 drain life damage, +15% XP" _"+4 урон высасыванием жизни, +15% ОП" attacks/blood-magic-1.png (
        strict_amla=yes
        require_amla="drain"
        max_times=1
        [effect]
            apply_to=attack
            name=drain
            increase_damage=4
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Serpent Khaganate AMLAs:

#define STEPPE_AMLA_KHAGAN
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT enslave_lvl4 _"Submission: enslave 3 is replaced by enslave 4, +20% XP" _"Подчинение: порабощение 3 заменено на порабощение 4, +20% ОП" attacks/evil-eye-gold-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=willbreak
            remove_specials=steppe_enslave
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_ENSLAVE 4}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#{STEPPE_ADVANCEMENT ruler_of_unlife _"Ruler of Unlife: enslave ability now works on non-living units, +20% XP" _"Повелитель Неживого: порабощение теперь работает на неживых юнитов, +20% ОП" attacks/evil-eye-eerie-3.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=willbreak
#            [set_specials]
#                mode=append
#                [damage]
#                    id=steppe_enslave_undead
#                    {TRANSLATE_ABILITY _"ruler of unlife" _"повелитель неживого"}
#                    {TRANSLATE_DESCRIPTION _"The enslave special now works on non-living units." _"Порабощение теперь работает и на неживых юнитов."}
#                [/damage]
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=20%
#        [/effect]
#)}

{STEPPE_ADVANCEMENT fire_damage _"+15% black fire damage, +15% XP" _"+15% урона черным огнем, +15% ОП" attacks/black-flame.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=blackfire
            increase_damage=15%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT enslave_damage _"+30% enslavement damage, +15% XP" _"+30% урона порабощением, +15% ОП" attacks/evil-eye-gold-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=willbreak
            increase_damage=30%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

#commented out, as extra accuracy is no longer relevant now that serpentheads have always hits on their enslave attacks

#{STEPPE_ADVANCEMENT willbreak_accuracy1 _"enslave attack gains 90% chance to hit, +15% XP" _"порабощение получает 90% шанс попасть, +15% ОП" #attacks/evil-eye-gold-2.png (
#        strict_amla=yes
#        max_times=1
#        [effect]
#            apply_to=attack
#            name=willbreak
#            remove_specials=steppe_focused
#            [set_specials]
#                mode=append
#                {WEAPON_SPECIAL_STEPPE_HYPERFOCUSED}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=15%
#        [/effect]
#)}
#
#{STEPPE_ADVANCEMENT willbreak_accuracy2 _"enslave attack gains 100% chance to hit, +15% XP" _"порабощение получает 100% шанс попасть, +15% ОП" #attacks/evil-eye-gold-3.png (
#        strict_amla=yes
#        max_times=1
#        require_amla="willbreak_accuracy1"
#        [effect]
#            apply_to=attack
#            name=willbreak
#            remove_specials=steppe_hyperfocused
#            [set_specials]
#                mode=append
#                {WEAPON_SPECIAL_STEPPE_ALWAYS_HITS}
#            [/set_specials]
#        [/effect]
#        [effect]
#            apply_to=max_experience
#            increase=15%
#        [/effect]
#)}

{STEPPE_ADVANCEMENT_FILTERED canrecruit _"Khagan's Authority: allows the unit to recruit, +15% XP" _"Каганская Власть: юнит может вербовать, +15% ОП" misc/leader-crown.png (
        canrecruit=no
) (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=new_ability
			[abilities]
              [dummy]
                 id=steppe_khagan_canrecruit #dummy ability to trigger post advance
              [/dummy]
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_NUCKELAVEE_BLACKSPEAR
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT melee_damage _"+2 melee damage, +20% XP" _"+2 ближний урон, +20% ОП" attacks/spear-nuckelavee-black.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT movement _"+1 moves, +20% XP" _"+1 ход, +15% ОП" attacks/kick-horse.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=movement
            increase=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_NUCKELAVEE_BANSHEETAUR
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT claw_drain _"claws gain the drain special, +20% XP" _"атака когтей получает высасывание, +20% ОП" attacks/claws-undead.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=claws
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_DRAIN}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT wail_damage _"+2 wail damage, +20% XP" _"+2 урон воем, +20% ОП" attacks/wail.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=wail
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_PUNISHER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+20% melee damage, +20% XP" _"+20% ближний урон, +20% ОП" attacks/scimitar.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT enslave_lvl2 _"enslave 1 is replaced by enslave 2, +20% XP" _"порабощение 1 заменено на порабощение 2, +20% ОП" attacks/whip.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=whip
            remove_specials=steppe_enslave
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_ENSLAVE_LIVING 2}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 33% is replaced by oversight 45%, +20% XP" _"надзор 33% заменено на надзор 45%, +20% ОП" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_OVERSIGHT 33}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 45}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef


#define STEPPE_AMLA_KHAGANATE_SENTINEL
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT melee_damage _"+20% melee damage, +20% XP" _"+20% ближний урон, +20% ОП" attacks/pike.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 15% ability and loyal trait, +20% XP" _"способность 'надзор 15%' и особенность 'верный', +20% ОП" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [filter]
        [not]
            formula="variation = freed"
        [/not]
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"lesser leadership ability and loyal trait, +20% XP (available only when freed)" _"способность 'низшее лидерство' и особенность 'верный', +20% ОП (доступно только если освобожден)" icons/haste-fire-2.png (
        strict_amla=yes
        max_times=1
        [filter]
            formula="variation = freed"
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_KHAGANATE_MARKSMAN
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT ranged_damage _"+20% ranged damage, +20% XP" _"+20% дальний урон, +20% ОП" attacks/bow-elven.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=ranged
            increase_damage=20%
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT oversight _"oversight 15% ability and loyal trait, +20% XP (available only when freed)" _"способность 'надзор 15%' и особенность 'верный', +20% ОП (доступно только если освобожден)" attacks/evil-eye-gold-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_OVERSIGHT 15}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"lesser leadership ability and loyal trait, +20% XP" _"способность 'низшее лидерство' и особенность 'верный', +20% ОП" icons/haste-fire-2.png (
        strict_amla=yes
        max_times=1
        [filter]
            formula="variation = freed"
        [/filter]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_loyaltrait #dummy ability to trigger post advance
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#-------------------------------------------------------------------------------
#Dead Field Coven AMLAs:


#define STEPPE_AMLA_RODIMITSA
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT onewithnature _"One with Nature: +10% forest defense and ambush ability, +20% XP" _"Близость к Природе: +10% защиты в лесу, способность 'засада', +20% ОП" icons/leaf-acid-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=defense
            replace=no
            [defense]
                forest=-10
            [/defense]
        [/effect]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT herbalmaster _"Herbal Mastery: heal +8 is replaced by heal +10, +20% XP" _"Травное Мастерство: лечит +8 заменено на лечит +10, +20% ОП" icons/heal-jade-2.png (
        strict_amla=yes
        max_times=1
		[effect]
			apply_to=remove_ability
			[abilities]
				{ABILITY_CURES}
			[/abilities]
		[/effect]
		[effect]
			apply_to=new_ability
			[abilities]
                {ABILITY_STEPPE_CURES 10}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT naturescruelty _"Nature's Cruelty: nature's curse attack gains poison special, +20% XP" _"Жестокость Природы: атака проклятия природы получает яд, +20% ОП" attacks/curse-witch-nature.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=curse
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_WILD_WITCH
{STEPPE_AMLA_HP}
{STEPPE_ADVANCEMENT swampstalk _"One with the Swamp: +10% swamp defense and swampstalk ability, +20% XP" _"Близость к Болоту: +10% защиты в болоте, способность 'болотная засада', +20% ОП" icons/swampstalk.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=defense
            replace=no
            [defense]
                swamp_water=-10
            [/defense]
        [/effect]
		[effect]
			apply_to=new_ability
			[abilities]
                {ABILITY_STEPPE_SWAMPSTALK}
			[/abilities]
		[/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT fire_damage _"+2 swamp fire damage, +20% XP" _"+2 урона болотным огнем, +20% ОП" attacks/swamp-fire.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=swamp fire
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT evileye _"Hateful Gaze: +3 evil eye damage, and evil eye gains the stun special, +20% XP" _"Ненавистный взгляд: +3 урон атакой сглазом, и атака получает оглушение, +20% ОП" attacks/gaze.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=evil eye
            increase_damage=3
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_STUN}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_FEAR_INCARNATE

#amla ideas: nightstalk, pack leader (leadership that only works on wolves), drain on melee

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT nightstalk _"Nightstalk ability, +20% XP" _"Способность 'невидимка', +20% ОП" attacks/horror-eerie-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_NIGHTSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT pack_alpha _"Pack alpha and skimirsher abilities, +25% XP" _"способности 'вожак стаи' и 'неулов', +15% ОП" icons/wild-eerie-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
            [leadership]
                id=steppe_pack_alpha
                value="(25 * (level - other.level))"
                cumulative=no
                {TRANSLATE_ABILITY _"pack alpha" "вожак стаи"}
                {TRANSLATE_DESCRIPTION _"Works like normal leadership, but only works on wolves." _"Работает как обычное лидерство, но только работет на волков."}
                affect_self=no
                [affect_adjacent]
                    [filter]
                        formula="level < other.level"
                        [and]
                            race=wolf
                            [or]
                                ability=steppe_wolf
                            [/or]
                        [/and]
                    [/filter]
                [/affect_adjacent]
            [/leadership]
                {ABILITY_SKIRMISHER}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

{STEPPE_ADVANCEMENT melee_damage _"+1 melee damage, +20% XP" _"+1 ближний урон, +20% ОП" attacks/fangs.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_SHADOWSHOT
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT shadow_poison _"Shadow Poison: bow and arrow dance attacks gain poison special, +20% XP" _"Теневой Яд: атаки лука и танца стрел получают яд, +20% ОП" icons/slice-acid-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=bow,arrowdance
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_MISTRESS_OF_DEAD_FIELD
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT arcane_shield _"Arcane Shield: +10% to all resistances, +20% XP" _"Магический Щит: +10% ко всем сопротивлениям, +20% ОП" icons/protect-magenta-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                arcane=-10
                fire=-10
                cold=-10
                blade=-10
                pierce=-10
                impact=-10
            [/resistance]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"Lesser Leadership ability, +20% XP" _"Способность 'низшее лидерство', +20% ОП" icons/haste-royal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT teleport _"Teleport ability, +20% XP" _"Способность 'телепорт', +20% ОП" icons/wind-grasp-eerie-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_TELEPORT}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_SLASHER
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT controlled_rage _"Controlled Rage: berserk now works only on offense, +20% XP" _"Управляемый Гнев: берсерк теперь действует только при атаке, +20% ОП" attacks/frenzy.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
#            range=melee
            special=berserk
            remove_specials=berserk
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_OFFENSE_BERSERK}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT swift_blade _"Swift Blade: melee gains the reliable special, +20% XP" _"Быстрый Клинок: ближняя атака получает надежность, +20% ОП" icons/slice-spirit-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_RELIABLE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#define STEPPE_AMLA_FIEND

#amla ideas: nightstalk, pack leader (leadership that only works on wolves), drain on melee

{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT bloodlust _"Bloodlust: drain 33% special on melee, and feeding ability, +20% XP" _"Кровожадный: получает высасывание 33% на ближнюю атаку, и способность 'пожиратель', +20% ОП" attacks/blood-magic-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_CUSTOM_DRAIN 33}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_FEEDING}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT melee_damage _"+2 melee damage, +20% XP" _"+2 ближний урон, +20% ОП" attacks/claws-undead.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}
#enddef

#-------------------------------------------------------------------------------
#Northern Knyaz Triumvirate AMLAs:

#define STEPPE_AMLA_TEMSK_BRAVEHEART
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT desperate _"Desperate: desperate special on melee, +20% XP" _"Отчаянный: получает отчаенность на ближнюю атаку, +20% ОП" attacks/frenzy.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_DESPERATE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT bloodlust _"Bloodlust: drain 30% special on melee, +20% XP" _"Кровожадный: получает высасывание 30% на ближнюю атаку, +20% ОП" attacks/blood-magic-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_STEPPE_CUSTOM_DRAIN 30}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT resolute _"Resolute ability, +20% XP" _"Способность 'непоколебимый', +20% ОП" icons/protect-red-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_RESOLUTE}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_TEMSK_CHAMPION
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT blade_mastery _"Blade Mastery: +1 damage and reliable special on sword in human form, +20% XP" _"Мастерство Клинка: +1 урона и надежность на меч в человеческой форме, +20% ОП" attacks/sword-human.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=sword
            increase_damage=1
        [/effect]
        [effect]
            apply_to=attack
            range=melee
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_RELIABLE}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT raven_damage _"Bird of Prey: +2 claw damage/+8 beak damage in raven form, and +4 raven damage in human form, +20% XP" _"Хищная Птица: +2 урона когтями/+8 урона клювом в форме ворона, и +4 урона вороном в человеческой форме, +20% ОП" attacks/beak.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=claws
            increase_damage=2
        [/effect]
        [effect]
            apply_to=attack
            name=beak
            increase_damage=8
        [/effect]
        [effect]
            apply_to=attack
            name=raven
            increase_damage=4
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT nightstalk _"Nightstalk ability for both forms, +20% XP" _"Способность 'невидимка' для обоих форм, +20% ОП" attacks/horror-eerie-1.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_NIGHTSTALK}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT lesser_leadership _"Lesser Leadership ability for both forms, +20% XP" _"Способность 'низшее лидерство' для обоих форм, +20% ОП" icons/haste-royal-2.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_LESSER_LEADERSHIP}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT footwork _"Footwork: skirmisher ability for human form, +15% XP" _"Маневренность: Способность 'неуловимый' для человеческой формы, +15% ОП" icons/boots_elven.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_SKIRMISHER}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=15%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_KRAD_ARCHITECT
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT tool_damage _"+2 damage for magical tools, +20% XP" _"+2 урона на волшебные инструменты, +20% ОП" attacks/axe.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=magical tools
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT stronger_buildings _"Stronger Buildings: this unit's buildings deal 25% more damage (doesn't apply to ones already built), +20% XP" _"Сильные Здания: здания построеные этим юнитом наносят 25% больше урона (не касается уже-построенных зданий), +20% ОП" attacks/ballista.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 25}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" _"Прочные Здания: здания построеные этим юнитом имеют 30% больше ХП (не касается уже-построенных зданий), +20% ОП" icons/stone_ring.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_ZIMNOVSK_ARCHITECT
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT_BUILDOPTION building_teleporter _"Teleporter: can build teleporters, +20% XP" _"Телепортер: можно строить телепортеры, +20% ОП" icons/runes-blue-3.png teleporter ( _ "Build Teleporter") ( _ "Построить Телепортер") 18 (Slav_Teleporter) 66 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT_BUILDOPTION building_library _"Library: can build libraries (buildings that give experience to adjacent allies each turn), +20% XP" _"Библиотека: можно строить библиотеки (здания которые каждый ход дают опыт стоящим рядом союзникам), +20% ОП" icons/book.png library ( _ "Build Library") ( _ "Построить Библоитеку") 14 (Slav_Library) 66 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT_BUILDOPTION building_makeshift_wall _"Makeshift Walls: can build wood walls for 0 gold but 75% move cost (dees not replace the 4 gold option, functionally both spiketraps are identical), +20% XP" _"Импровизированные Стены: можно строить шипы за 0 золота но 75% ходов (не заменяет 4-золотовую версию, функциональное обе стены одинаковые), +20% ОП" "terrain/castle/encampment/regular-tile.png" makeshift_woodwall ( _ "Build makeshift wall") ( _ "Построить импровизированную стену") 0 (Woodwall) 75 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT tool_damage _"+2 damage for magical tools, +20% XP" _"+2 урона на волшебные инструменты, +20% ОП" attacks/hammer.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=magical tools
            increase_damage=2
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT sturdier_buildings _"Studier Buildings: this unit's buildings have 30% more hitpoints (doesn't apply to ones already built), +20% XP" _"Прочные Здания: здания построеные этим юнитом имеют 30% больше ХП (не касается уже-построенных зданий), +20% ОП" icons/stone_ring.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_HITPOINTS 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_TEMSK_ARCHITECT
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT_BUILDOPTION building_hiding_spot _"Hiding spot: can build hiding spots, +20% XP" _"Укрытие: можно строить укрытия, +20% ОП" icons/hiding-spot.png hiding_spot ( _ "Build Hiding Spot") ( _ "Построить Укрытие") 10 (Slav_Hiding_Spot) 66 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT_BUILDOPTION building_makeshift_spikes _"Makeshift Spikes: can build spikes for 0 gold but 80% move cost (dees not replace the 3 gold option, functionally both spiketraps are identical), +20% XP" _"Импровизированные Шипы: можно строить шипы за 0 золота но 80% ходов (не заменяет 3-золотовую версию, функциональное обе ловушки одинаковые), +20% ОП" attacks/spikes.png makeshift_spiketrap ( _ "Build makeshift spikes") ( _ "Построить импровизированные шипы") 0 (Spiketrap) 80 (
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT tool_damage_and_poison _"+1 damage and poison for magical tools, +20% XP" _"+1 урона и яд на волшебные инструменты, +20% ОП" attacks/spikes-poison.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=magical tools
            increase_damage=1
            set_icon=attacks/spikes-poison.png
            [set_specials]
                mode=append
                {WEAPON_SPECIAL_POISON}
            [/set_specials]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT deadlier_traps _"Deadlier Traps: this unit's traps deal 30% more damage (doesn't apply to traps already built), +20% XP" _"Смертельные Ловушки: ловушки построеные этим юнитом наносят 30% больше урона (не касается уже-построенных зданий), +20% ОП" attacks/spear-nuckelavee.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_BUILDING_BONUS_DAMAGE 30}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef

#define STEPPE_AMLA_LUMINARY
{STEPPE_AMLA_HP}

{STEPPE_ADVANCEMENT herbalmaster _"Healing Light: heal +6 is replaced by heal +9, +20% XP" _"Исцеляющий Свет: лечит +6 заменено на лечит +9, +20% ОП" icons/heal-royal-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=remove_ability
            [abilities]
                {ABILITY_STEPPE_CURES 6}
            [/abilities]
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
                {ABILITY_STEPPE_CURES 9}
            [/abilities]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT ranged_damage _"+3 light burst damage, +1 solar flame damage, +20% XP" _"+3 урона на всплекс света, +1 урона на солнечное пламя, +20% ОП" attacks/light-burst.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=attack
            name=light burst
            increase_damage=3
        [/effect]
        [effect]
            apply_to=attack
            name=solar flame
            increase_damage=1
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

{STEPPE_ADVANCEMENT light_shield _"Light Shield: +30% fire/arcane resistances, +20% XP" _"Световой Щит: +30% сопротивления к огню/мистике, +20% ОП" icons/protect-royal-3.png (
        strict_amla=yes
        max_times=1
        [effect]
            apply_to=resistance
            replace=no
            [resistance]
                arcane=-30
                fire=-30
            [/resistance]
        [/effect]
        [effect]
            apply_to=max_experience
            increase=20%
        [/effect]
)}

#enddef