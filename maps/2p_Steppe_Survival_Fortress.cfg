#textdomain wesnoth-multiplayer

[multiplayer]
    id=steppe_2p_survival_fortress
#ifdef OGRE_RUSSIAN
    name= _ "Степь - 2и — Степная Крепость (Выживание)"
    description= _ "Степная Крепость это сценарий-виживание в котором вы должны выстоять против волн степных юнитов.

"+{STEPPE_MUSIC_FOUND_STATUS_RUSSIAN}
#else
    name= _ "Steppe - 2p — Steppe Fortress (Survival)"
    description= _ "Steppe Fortress is a survival scenario where you face off against waves of steppe units.

"+{STEPPE_MUSIC_FOUND_STATUS}
#endif

    experience_modifier=100
    map_data="{~add-ons/1The_Great_Steppe_Era/maps/Steppe_Survival_Fortress_2p.map}"
    victory_when_enemies_defeated=no
    force_lock_settings=no
    turns=-1
#to prevent people joining the map without GSE installed:
    require_scenario=yes

    experience_modifier=70%

    random_start_time=no

    {DEFAULT_SCHEDULE_DAWN}

    mp_village_gold=1
    mp_village_support=2

#added the eventloader here just in case someone plays the map with a non-GSE era
    [load_resource]
        id=GSE_resource
    [/load_resource]

    [side]
        side=1
        team_name="ogres"
        user_team_name= _ "teamname^Bull Tumen"
        color=brown
        allow_player=no
        disallow_observers=yes
        no_leader=yes
        controller="ai"
        [ai]
        [goal]
            name=protect_unit
            [criteria]
                ability=steppe_survival_boss
                side=1
            [/criteria]
            protect_radius=10
            value=10
        [/goal]
        [/ai]
    [/side]

    [side]
        side=2
        team_name="khaganate"
        user_team_name= _ "teamname^Serpent Khaganate"
        color=orange
        allow_player=no
        disallow_observers=yes
        no_leader=yes
        controller="ai"
        [ai]
        [goal]
            name=protect_unit
            [criteria]
                ability=steppe_survival_boss
                side=2
            [/criteria]
            protect_radius=10
            value=10
        [/goal]
        [/ai]
    [/side]

    [side]
        side=3
        team_name="coven"
        user_team_name= _ "teamname^Dead Field Coven"
        color=purple
        allow_player=no
        disallow_observers=yes
        no_leader=yes
        controller="ai"
        [ai]
        [goal]
            name=protect_unit
            [criteria]
                ability=steppe_survival_boss
                side=3
            [/criteria]
            protect_radius=10
            value=10
        [/goal]
        [/ai]
    [/side]

    [side]
        side=4
        canrecruit=yes
        color=red
        team_name="human"
        user_team_name= _ "teamname^Human"
        controller="human"
        save_id="Player1"
        gold=150
        income=2
        gold_lock=yes
        income_lock=yes
        controller_lock=no
        team_lock=yes
        faction_lock=no
        leader_lock=no
        color_lock=no
        fog=no#yes
        share_vision=all
        [village]
            x=16
            y=20
        [/village]
    [/side]

    [side]
        side=5
        canrecruit=yes
        color=blue
        team_name="human"
        user_team_name= _ "teamname^Human"
        controller="human"
        save_id="Player2"
        gold=150
        income=2
        gold_lock=yes
        income_lock=yes
        controller_lock=no
        team_lock=yes
        faction_lock=no
        leader_lock=no
        color_lock=no
        fog=no#yes
        share_vision=all
        [village]
            x=22
            y=17
        [/village]
    [/side]
    [event]
        name=prestart
        [modify_side]
            side=1
            {FLAG_VARIANT ragged}
        [/modify_side]        
        [modify_side]
            side=2
            {FLAG_VARIANT long}
        [/modify_side]        
        [modify_side]
            side=3
            {FLAG_VARIANT undead}
        [/modify_side]        
        [store_unit]
            variable=leader
            [filter]
                side=2,3
            [/filter]
            kill=no
        [/store_unit]
        [if]
            [variable]
                name=leader.length
                less_than=2
            [/variable]
            [then]
                {VARIABLE lose_condition_string ( _ "Death of your leader")}
#                {VARIABLE notes ( _ "Since your team has only one leader, the enemy waves will not be at full strength.")}
            [/then]
            [else]
                {VARIABLE lose_condition_string ( _ "Death of both of your team’s leaders")}
#                {VARIABLE notes ( _ "Since your team has two leaders, the enemy waves will be at full strength.")}
            [/else]
        [/if]
        {CLEAR_VARIABLE leader}

        [objectives]
            [objective]
                description= _ "Survive and defeat all enemy waves"
                condition=win
            [/objective]
            [objective]
                description=$lose_condition_string
                condition=lose
            [/objective]

            [note]
                {TRANSLATE_DESCRIPTION _"The last wave is at turn 43" _"Последняя волна на ходу 43"}
            [/note]
        [/objectives]

#        {CLEAR_VARIABLE lose_condition_string}
#        {CLEAR_VARIABLE notes}

#MAI that acts as a fallback - if the ai somehow has nothing to do, try to make it approach the fortress (only really needed for my experiment to see which AI side would win if the ai sides all fought against eachother):
        [micro_ai]
            side=1
            ai_type=goto
            action=add
            ca_id=gotofortress
            [filter]
            [/filter]
            [filter_location]
                x,y=19,19
                radius=3
            [/filter_location]
            ca_score=10000 #rather low priority CA, as it's mostly just a fallback
            ignore_enemy_at_goal=yes
            ignore_units=yes
            release_unit_at_goal=yes
        [/micro_ai]
        [micro_ai]
            side=2
            ai_type=goto
            action=add
            ca_id=gotofortress
            [filter]
            [/filter]
            [filter_location]
                x,y=19,19
                radius=3
            [/filter_location]
            ca_score=10000 #rather low priority CA, as it's mostly just a fallback
            ignore_enemy_at_goal=yes
            ignore_units=yes
            release_unit_at_goal=yes
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=goto
            action=add
            ca_id=gotofortress
            [filter]
            [/filter]
            [filter_location]
                x,y=19,19
                radius=3
            [/filter_location]
            ca_score=10000 #rather low priority CA, as it's mostly just a fallback
            ignore_enemy_at_goal=yes
            ignore_units=yes
            release_unit_at_goal=yes
        [/micro_ai]
    [/event]

    [event]
        name=start
#ifdef STEPPE_MUSIC
#calm music early on while the players build up their defense
        {REPLACE_SCENARIO_MUSIC camel_soup.ogg}
#else
        {REPLACE_SCENARIO_MUSIC casualties_of_war.ogg}
#endif
#        [message]
#            caption= _"Dark Forecast — a random survival scenario"
#            speaker=narrator
#            image=misc/time-schedules/default/schedule-dawn.png
#            #wmllint: local spellings jb Rhuvaen
#            #wmllint: display on
#            message= _ "Your aim is to survive the spawning waves of units and defeat the final archenemies.
#
#The spawning waves are randomly generated and will be different each time Dark Forecast is played.
#
#They appear along the north, south, and west map edges — though they are most likely to spawn on the west edge. The waves appear at somewhat regular #intervals.
#
#The weather will also change randomly, affecting the layout of the map.
#
#
#<b>Dark Forecast was made by:</b>
#
#<span color='green'>ForestDragon:</span>
#• WML implementation
#<span color='green'>Mechanical:</span>
#• Map design, spawn groups, and scenario concept"
#            #wmllint: display off
#        [/message]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TRANSLATE_MESSAGE _"Far, far away, where the steppe, the desert and the dead field intersect, there was a ruined fortress. It was built by the slaves of the great Khagan, then they were driven out of there by ogres from the Tumen, and a little later the ancient steppe rulers from the barrows pushed the ogres out. Then for many years the powerful of this world tried to take possession of the fortress, many soldiers had fallen next to its walls, but they did not achieve success - and abandoned it. " _"Далеко-далеко, там, где пересекаются степь, пустыня и мёртвое поле, стояла разрушенная крепость. Построили её рабы великого Кагана, затем их выбили оттуда огры из Тумена, а немного погодя древние степные владыки из курганов потеснили и огров. Затем много лет сильные мира сего пытались завладеть крепостью, немало воинов под её стенами положили, да успеха не добились - и забросили."}
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TRANSLATE_MESSAGE _"However, times have changed. The fire of a new war between the steppe rulers is flaring up brighter and brighter. They again remembered this fortress. And once again they sent their armies to take possession of it." _"Однако времена изменились. Всё ярче разгорается огонь новой войны между степными властителями. Вновь вспомнили они про крепость эту. Вновь отправили свои армии, чтобы завладеть ей."}
        [/message]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TRANSLATE_MESSAGE _"Two brave commanders were the first to reach the fortress. Now they need to gain a foothold here and keep it - both from enemies and rivals who want to take away the glory of conquest." _"Два отважных командира первыми добрались до крепости. Теперь им нужно закрепиться здесь и удержать её - и от врагов, и от конкурентов, которые хотят отнять у них славу захватчиков."}
        [/message]
        [message]
            side=4
            canrecruit=yes
            {TRANSLATE_MESSAGE _"This isn't a fortress, it's a damn tomb! I can feel the bones crunch under my feet." _"Это не крепость, это настоящий склеп! Кости так и хрустят под ногами."}
        [/message]
        [message]
            side=5
            canrecruit=yes
            {TRANSLATE_MESSAGE _"I heard that when the dead tsars took over this fortress, they made two barrows from the corpses. There were remains of creatures from around the world! And then the ogres destroyed the barrows when searching for loot. Now there is little left of the barrows, and bones are all over the place." _"Я слышал, что когда крепость захватили мёртвые цари, они сложили из трупов эти два кургана. Там были останки существ со всего мира! А потом пришли огры и разгромили курганы в поисках наживы. Теперь от курганов осталось немного, а кости везде."}
        [/message]
        [message]
            side=4
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Since we decided to fortify here, we need to burn the remains. My warriors have already set up the fires." _"Раз мы решили закрепиться здесь, останки нужно сжечь. Мои воины уже развели костры."}
        [/message]
        [message]
            side=5
            canrecruit=yes
            {TRANSLATE_MESSAGE _"So be it. But what is it? Hear that? Battle drums. In a few hours there will be a fight, just like in old times." _"Да будет так. Но что это? Слышишь? Боевые барабаны. Через пару часов здесь начнётся бой, прямо как в старые времена."}
        [/message]
        [message]
            side=4
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Then we must prepare. Warriors, to arms!" _"Значит мы должны быть готовы. Воины, к оружию!"}
        [/message]
    [/event]

#define STEPPE_GENERIC_UNIT SIDE TYPE X Y
#like GENERIC_UNIT, but with "placement=map_passable" so that units don't spawn inside walls
    [unit]
        side={SIDE}
        type={TYPE}
        x={X}
        y={Y}
        generate_name=yes
        random_traits=yes
        random_gender=yes
        upkeep=full
        placement=map_passable
    [/unit]
#enddef

#define STEPPE_SURVIVAL_BOSS_UNIT ID TYPE SIDE X Y
#bosses that spawn at the final wave
    [unit]
        id={ID}
        side={SIDE}
        type={TYPE}
        x={X}
        y={Y}
        generate_name=yes
        random_traits=no
        random_gender=yes
        upkeep=full
        placement=map_passable
        {IS_HERO}
        [modifications]
    [trait]
        id=steppe_boss
#ifdef OGRE_RUSSIAN
        male_name= _ "босс"
        female_name= _ "female^босс"
#else
        male_name= _ "boss"
        female_name= _ "female^boss"
#endif
        [effect]
            apply_to=hitpoints
            increase_total=40%
        [/effect]        
        [effect]
            apply_to=attack
            increase_damage=30%
        [/effect]
        [effect]
            apply_to=new_ability
            [abilities]
              [dummy]
                 id=steppe_survival_boss #dummy ability to trigger events
              [/dummy]
            [/abilities]
        [/effect]
        [effect]
            apply_to=loyal
        [/effect]
    [/trait]
        [/modifications]
    [/unit]
#enddef

#define OGRE_SPAWN_CENTER NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 1 ({TYPE}) 3 11}
)}
#enddef

#define OGRE_SPAWN_LEFT NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 1 ({TYPE}) 3 18}
)}
#enddef

#define OGRE_SPAWN_RIGHT NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 1 ({TYPE}) 10 7}
)}
#enddef

#define KHAGANATE_SPAWN_CENTER NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 2 ({TYPE}) 19 35}
)}
#enddef

#define KHAGANATE_SPAWN_LEFT NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 2 ({TYPE}) 12 31}
)}
#enddef

#define KHAGANATE_SPAWN_RIGHT NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 2 ({TYPE}) 26 31}
)}
#enddef

#define COVEN_SPAWN_CENTER NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 3 ({TYPE}) 35 11}
)}
#enddef

#define COVEN_SPAWN_LEFT NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 3 ({TYPE}) 28 7}
)}
#enddef

#define COVEN_SPAWN_RIGHT NUMBER TYPE
{REPEAT {NUMBER} (
    {STEPPE_GENERIC_UNIT 3 ({TYPE}) 35 18}
)}
#enddef


#spawn waves:

    [event]
        name=turn 3
        #wave 1:

        [sound]
            name=horn-signals/horn-2.ogg
        [/sound]

#ifdef STEPPE_MUSIC
        {REPLACE_SCENARIO_MUSIC tribal_war_song_shortened.ogg}
        {APPEND_MUSIC northerners.ogg}
        {APPEND_MUSIC battlecry.ogg}
#else
        {REPLACE_SCENARIO_MUSIC northerners.ogg}
        {APPEND_MUSIC battle.ogg}
        {APPEND_MUSIC siege_of_laurelmor.ogg}
        {APPEND_MUSIC the_city_falls.ogg}
#endif

        {OGRE_SPAWN_CENTER 2 Ogre_Hunter}
        {OGRE_SPAWN_LEFT 1 Ogre_Bull}
        {OGRE_SPAWN_RIGHT 1 Ogre_Bull}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_Overseer}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Slave_Bowman}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Slave_Spearman}

        {COVEN_SPAWN_CENTER 2 Hunn_Barrow_Rider}
        {COVEN_SPAWN_LEFT 1 Hunn_Fear_Shadow}
        {COVEN_SPAWN_RIGHT 1 Hunn_Fear_Shadow}
    [/event]

    [event]
        name=turn 7
        #wave 2:

        [sound]
            name=horn-signals/horn-6.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Bull}
        {OGRE_SPAWN_LEFT 2 Ogre_Hunter}
        {OGRE_SPAWN_RIGHT 2 Ogre_Grunt_steppe}

        {KHAGANATE_SPAWN_CENTER 2 Khaganate_Nuckelavee}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Gnoll_Biter}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Gnoll_Biter}

        {COVEN_SPAWN_CENTER 3 Hunn_Barrow_Rider}
        {COVEN_SPAWN_LEFT 2 Hunn_Fear_Shadow}
        {COVEN_SPAWN_RIGHT 2 Hunn_Fear_Shadow}
    [/event]

    [event]
        name=turn 11
        #wave 3:

        [sound]
            name=horn-signals/horn-2.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Chariot}
        {OGRE_SPAWN_LEFT 2 Ogre_Grunt_steppe}
        {OGRE_SPAWN_RIGHT 2 Ogre_Grunt_steppe}
        {OGRE_SPAWN_LEFT 1 Ogre_Hunter}
        {OGRE_SPAWN_RIGHT 1 Ogre_Hunter}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Serpenthead}
        {KHAGANATE_SPAWN_LEFT 1 Khaganate_Naga_Overseer}
        {KHAGANATE_SPAWN_RIGHT 1 Khaganate_Naga_Overseer}
        {KHAGANATE_SPAWN_LEFT 3 Khaganate_Slave_Bowman}
        {KHAGANATE_SPAWN_RIGHT 3 Khaganate_Slave_Spearman}

        {COVEN_SPAWN_CENTER 3 Hunn_Chernava}
        {COVEN_SPAWN_LEFT 2 Hunn_Barrow_Rider}
        {COVEN_SPAWN_RIGHT 2 Hunn_Barrow_Rider}
    [/event]

    [event]
        name=turn 15
        #wave 4:

        [sound]
            name=horn-signals/horn-6.ogg
        [/sound]


        {OGRE_SPAWN_CENTER 1 Ogre_Tribal_Bull}
        {OGRE_SPAWN_LEFT 2 Ogre_Bull}
        {OGRE_SPAWN_RIGHT 2 Ogre_Bull}
        {OGRE_SPAWN_LEFT 1 Ogre_Tarbynn}
        {OGRE_SPAWN_RIGHT 1 Ogre_Tarbynn}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_Punisher}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_Overseer}
        {KHAGANATE_SPAWN_LEFT 1 Khaganate_Slave_Infantry}
        {KHAGANATE_SPAWN_RIGHT 1 Khaganate_Slave_Archer}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Slave_Bowman}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Slave_Spearman}

        {COVEN_SPAWN_CENTER 1 Hunn_Primal_Spawn}
        {COVEN_SPAWN_LEFT 2 Hunn_Barrow_Rider}
        {COVEN_SPAWN_RIGHT 2 Hunn_Barrow_Rider}
        {COVEN_SPAWN_LEFT 1 Hunn_Fear_Manifestation}
        {COVEN_SPAWN_RIGHT 1 Hunn_Fear_Manifestation}
    [/event]

    [event]
        name=turn 19
        #wave 5:

        [sound]
            name=horn-signals/horn-2.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Butcher_steppe}
        {OGRE_SPAWN_RIGHT 2 Ogre_Hunter}
        {OGRE_SPAWN_LEFT 2 Ogre_Grunt_steppe}
        {OGRE_SPAWN_RIGHT 1 Ogre_Chariot}
        {OGRE_SPAWN_LEFT 1 Ogre_Chariot}


        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Gnoll_Ripper}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Gnoll_Biter}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Gnoll_Biter}
        {KHAGANATE_SPAWN_LEFT 1 Khaganate_Vampire}
        {KHAGANATE_SPAWN_RIGHT 1 Khaganate_Vampire}

        {COVEN_SPAWN_CENTER 1 Hunn_Dark_Matron}
        {COVEN_SPAWN_LEFT 2 Hunn_Kanavar}
        {COVEN_SPAWN_RIGHT 2 Hunn_Kanavar}
        {COVEN_SPAWN_LEFT 1 Hunn_Barrow_Rider}
        {COVEN_SPAWN_RIGHT 1 Hunn_Barrow_Rider}
    [/event]

    [event]
        name=turn 23
        #wave 6:

        [sound]
            name=horn-signals/horn-6.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Foreman}
        {OGRE_SPAWN_CENTER 1 Ogre_Apprentice}
        {OGRE_SPAWN_RIGHT 2 Ogre_Hunter}
        {OGRE_SPAWN_LEFT 3 Ogre_Grunt_steppe}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Nuckelavee_Blackspear}
        {KHAGANATE_SPAWN_CENTER 2 Khaganate_Nuckelavee}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_Overseer}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Slave_Infantry}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Slave_Infantry}


        {COVEN_SPAWN_CENTER 1 Hunn_Barrow_Warden}
        {COVEN_SPAWN_CENTER 1 Hunn_Wild_Witch}
        {COVEN_SPAWN_LEFT 2 Hunn_Barrow_Rider}
        {COVEN_SPAWN_RIGHT 2 Hunn_Barrow_Rider}
        {COVEN_SPAWN_LEFT 2 Hunn_Fear_Shadow}
        {COVEN_SPAWN_RIGHT 2 Hunn_Fear_Shadow}
    [/event]

    [event]
        name=turn 27
        #wave 7:

        [sound]
            name=horn-signals/horn-2.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Battle_Chariot}
        {OGRE_SPAWN_CENTER 1 Ogre_Skirmisher}
        {OGRE_SPAWN_CENTER 1 Ogre_Burner}
        {OGRE_SPAWN_RIGHT 1 Ogre_Mancatcher}
        {OGRE_SPAWN_LEFT 1 Ogre_Mancatcher}
        {OGRE_SPAWN_RIGHT 1 Ogre_Chariot}
        {OGRE_SPAWN_LEFT 1 Ogre_Chariot}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_Commander}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Serpenthead_Tarhan}
        {KHAGANATE_SPAWN_LEFT 3 Khaganate_Slave_Infantry}
        {KHAGANATE_SPAWN_RIGHT 3 Khaganate_Slave_Archer}
        {KHAGANATE_SPAWN_LEFT 1 Khaganate_Slave_Bowman}
        {KHAGANATE_SPAWN_RIGHT 1 Khaganate_Slave_Spearman}

        {COVEN_SPAWN_CENTER 1 Hunn_Demon}
        {COVEN_SPAWN_CENTER 1 Hunn_Kanavar_Marksman}
        {COVEN_SPAWN_CENTER 1 Hunn_Rodimitsa}
        {COVEN_SPAWN_LEFT 1 Hunn_Kanavar}
        {COVEN_SPAWN_RIGHT 1 Hunn_Kanavar}
        {COVEN_SPAWN_LEFT 1 Hunn_Barrow_Rider}
        {COVEN_SPAWN_RIGHT 1 Hunn_Barrow_Rider}
    [/event]

    [event]
        name=turn 31
        #wave 8:

        [sound]
            name=horn-signals/horn-6.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Pursuer}
        {OGRE_SPAWN_CENTER 1 Ogre_Bull_Priest}
        {OGRE_SPAWN_CENTER 1 Ogre_Tribal_Bull}
        {OGRE_SPAWN_RIGHT 1 Ogre_Terror}
        {OGRE_SPAWN_LEFT 1 Ogre_Terror}
        {OGRE_SPAWN_RIGHT 1 Ogre_Tarbynn}
        {OGRE_SPAWN_LEFT 1 Ogre_Tarbynn}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Gnoll_Shredder}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Vampire_Elite}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Nuckelavee_Bansheetaur}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Vampire}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Vampire}
        {KHAGANATE_SPAWN_LEFT 1 Khaganate_Nuckelavee}
        {KHAGANATE_SPAWN_RIGHT 1 Khaganate_Nuckelavee}

        {COVEN_SPAWN_CENTER 1 Hunn_Primal_Fury}
        {COVEN_SPAWN_CENTER 1 Hunn_Barrow_Warden}
        {COVEN_SPAWN_CENTER 1 Hunn_Wild_Witch}
        {COVEN_SPAWN_LEFT 1 Hunn_Fear_Incarnate}
        {COVEN_SPAWN_RIGHT 1 Hunn_Fear_Incarnate}
        {COVEN_SPAWN_LEFT 1 Hunn_Fear_Shadow}
        {COVEN_SPAWN_RIGHT 1 Hunn_Fear_Shadow}
    [/event]

    [event]
        name=turn 35
        #wave 9:

        [sound]
            name=horn-signals/horn-2.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Slaver_steppe}
        {OGRE_SPAWN_CENTER 1 Ogre_Bodyguard}
        {OGRE_SPAWN_CENTER 3 Ogre_Slaver_Apprentice}
        {OGRE_SPAWN_RIGHT 2 Ogre_Mancatcher}
        {OGRE_SPAWN_LEFT 2 Ogre_Mancatcher}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_General}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Naga_Commander}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Serpenthead_Tarhan}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Sentinel}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Marksman}
        {KHAGANATE_SPAWN_LEFT 3 Khaganate_Slave_Infantry}
        {KHAGANATE_SPAWN_RIGHT 3 Khaganate_Slave_Archer}

        {COVEN_SPAWN_CENTER 1 Hunn_Grand_Witch}
        {COVEN_SPAWN_CENTER 1 Hunn_Kanavar_Shadowshot}
        {COVEN_SPAWN_LEFT 1 Hunn_Kanavar_Slasher}
        {COVEN_SPAWN_RIGHT 1 Hunn_Kanavar_Slasher}
        {COVEN_SPAWN_LEFT 2 Hunn_Kanavar}
        {COVEN_SPAWN_RIGHT 2 Hunn_Kanavar}
    [/event]

    [event]
        name=turn 39
        #wave 10:

        [sound]
            name=horn-signals/horn-6.ogg
        [/sound]

        {OGRE_SPAWN_CENTER 1 Ogre_Tempest_Lord}
        {OGRE_SPAWN_CENTER 1 Ogre_Scorcher}
        {OGRE_SPAWN_CENTER 3 Ogre_Thunder_Shaman}
        {OGRE_SPAWN_CENTER 1 Ogre_Bull_Priest}
        {OGRE_SPAWN_RIGHT 1 Ogre_Apprentice}
        {OGRE_SPAWN_LEFT 1 Ogre_Apprentice}

        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Vampire_Master}
        {KHAGANATE_SPAWN_CENTER 1 Khaganate_Gnoll_Shredder}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Vampire_Elite}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Vampire_Elite}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Vampire}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Vampire}

        {COVEN_SPAWN_CENTER 1 Hunn_Primal_Patriarch}
        {COVEN_SPAWN_CENTER 1 Hunn_Barrow_Tsar}
        {COVEN_SPAWN_CENTER 1 Hunn_Primal_Spawn}
        {COVEN_SPAWN_LEFT 2 Hunn_Barrow_Warden}
        {COVEN_SPAWN_RIGHT 2 Hunn_Barrow_Warden}
    [/event]

    [event]
        name=turn 43
        #wave 11:

        {REPLACE_SCENARIO_MUSIC silence.ogg}

        [sound]
            name=horn-signals/horn-7.ogg
        [/sound]

        {STEPPE_SURVIVAL_BOSS_UNIT ogreboss Ogre_Centurion 1 3 11}
        {OGRE_SPAWN_CENTER 1 Ogre_Bull_Prophet}
        {OGRE_SPAWN_CENTER 1 Ogre_Tempest_Lord}
        {OGRE_SPAWN_CENTER 1 Ogre_Abomination}
        {OGRE_SPAWN_RIGHT 1 Ogre_Slaver_steppe}
        {OGRE_SPAWN_RIGHT 1 Ogre_Bodyguard}
        {OGRE_SPAWN_LEFT 1 Ogre_Foreman}
        {OGRE_SPAWN_LEFT 2 Ogre_Grunt_steppe}

        {STEPPE_SURVIVAL_BOSS_UNIT khaganateboss Khaganate_Naga_General 2 19 35}
        {KHAGANATE_SPAWN_CENTER 2 Khaganate_Serpenthead_Tarhan}
        {KHAGANATE_SPAWN_LEFT 1 Khaganate_Naga_Punisher}
        {KHAGANATE_SPAWN_RIGHT 1 Khaganate_Naga_Punisher}
        {KHAGANATE_SPAWN_LEFT 5 Khaganate_Slave_Infantry}
        {KHAGANATE_SPAWN_RIGHT 5 Khaganate_Slave_Archer}
        {KHAGANATE_SPAWN_LEFT 2 Khaganate_Sentinel}
        {KHAGANATE_SPAWN_RIGHT 2 Khaganate_Marksman}

        {STEPPE_SURVIVAL_BOSS_UNIT covenboss Hunn_Demon_General 3 35 11}
        {COVEN_SPAWN_CENTER 1 Hunn_Demon_Warmonger}
        {COVEN_SPAWN_CENTER 1 Hunn_Grand_Witch}
        {COVEN_SPAWN_CENTER 1 Hunn_Rodimitsa}
        {COVEN_SPAWN_LEFT 2 Hunn_Kanavar_Marksman}
        {COVEN_SPAWN_RIGHT 2 Hunn_Kanavar_Marksman}        
        {COVEN_SPAWN_LEFT 1 Hunn_Kanavar}
        {COVEN_SPAWN_RIGHT 1 Hunn_Kanavar}

        [delay]
            time=3000
        [/delay]

#ifdef STEPPE_MUSIC
        {REPLACE_SCENARIO_MUSIC In_the_Land_of_Madness.ogg}
#else
        {REPLACE_SCENARIO_MUSIC frantic.ogg}
#endif


        [message]
            side=4
            canrecruit=yes
            {TRANSLATE_MESSAGE _"The best troops, led by the generals themselves, are marching towards us! " _"Лучшие войска во главе с самими полководцами идут на нас!"}
        [/message]
        [message]
            side=5
            canrecruit=yes
            {TRANSLATE_MESSAGE _"If we can beat them back, the fortress is ours!" _"Если справимся с ними, сможем удержать крепость!"}
        [/message]

        [objectives]
            [objective]
                {TRANSLATE_DESCRIPTION _"Kill the enemy generals (silver crown)" _"Убить полководцев врага (с серебряной короной)"}
                condition=win
            [/objective]
            [objective]
                description=$lose_condition_string
                condition=lose
            [/objective]

#            [note]
#                description=$notes
#            [/note]
        [/objectives]        
    [/event]

    [event]
        name=die,steppe_customevent_enslave
        first_time_only=no
        [filter]
        ability=steppe_survival_boss
        [/filter]
        {IF_VAR unit.variables.origside equals $steppe_nonexistent_variable (
        [then]
        {VARIABLE unit.variables.origside $unit.side}
        [/then]
        )}

#store a random living unit to say dialog
        [role]
        role=retreating_enemy
        side=$unit.variables.origside
        [filter_wml]
        [not]
        [status]
            not_living="yes"
        [/status]
        [/not]
        [/filter_wml]
        [not]
        id=$unit.id
        [/not]
        [/role]

        {RANDOM 1..4}
        [switch]
        variable=random
        [case]
            value=1
            [message]
                role=retreating_enemy
                {TRANSLATE_MESSAGE _"The general is dead! Run!" _"Полководец убит! Бежим!"}
            [/message]
        [/case]
        [case]
            value=2
            [message]
                role=retreating_enemy
                {TRANSLATE_MESSAGE _"Retreat!" _"Отступаем!"}
            [/message]
        [/case]
        [case]
            value=3
            [message]
                role=retreating_enemy
                {TRANSLATE_MESSAGE _"Run, run!" _"Бежим, бежим!"}
            [/message]
        [/case]
        [case]
            value=4
            [message]
                role=retreating_enemy
                {TRANSLATE_MESSAGE _"I don't want to stay next to these damned walls!" _"Я не хочу остаться под этими проклятыми стенами!"}
            [/message]
        [/case]
        [/switch]
        [kill]
            side=$unit.variables.origside
            animate=no
            fire_event=no
            [not]
            id=$unit.id
            [/not]
        [/kill]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TRANSLATE_MESSAGE _"With the death of the commander, the army fell into panic and the soldiers rushed away from the battlefield." _"Со смертью командира войско охватила паника и солдаты ринулись прочь с поля боя."}
        [/message]

        [if]
        [have_unit]
        ability=steppe_survival_boss
        side=1,2,3 #extra check to account for enslaved bosses
        [/have_unit]
        [else]
        [if]
        [have_unit]
        side=4
        canrecruit=yes
        [/have_unit]
        [and]
        [have_unit]
        side=5
        canrecruit=yes
        [/have_unit]
        [/and]
        [then]
        #todo: put an event here with the leaders betraying eachother:
#ifdef STEPPE_MUSIC
        {REPLACE_SCENARIO_MUSIC overlive.ogg}
#else
        {REPLACE_SCENARIO_MUSIC weight_of_revenge.ogg}
#endif
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            {TRANSLATE_MESSAGE _"The commanders watched from the blood-drenched walls as the enemies flee. Their warriors, tired of the battle, sighed with relief. It seemed to them that the battle was over, but each of the commanders understood that one more obstacle remained on the way to triumph..." _"Командиры смотрели с залитых кровью стен, как враги бегут прочь. Их воины, утомлённые битвой, облегчённо вздыхали. Им казалось, что сражение окончено, но каждый из командиров понимал, что на пути к триумфу осталась ещё одна преграда..."}
        [/message]
        [message]
            side=4
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Seems there is only one foe left in my path." _"Похоже, на моём пути остался всего один противник."}
        [/message]
        [message]
            side=5
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Mine too. But the glory of conquering the fortress shall be mine! " _"Как и на моём. Вот только слава завоевателя крепости достанется мне!"}
        [/message]
        [message]
            side=4
            canrecruit=yes
            {TRANSLATE_MESSAGE _"We'll see about that." _"Это мы ещё посмотрим."}
        [/message]
#player sides turn on eachother
        [modify_side]
            side=4
            team_name=player1
        [/modify_side]
        [modify_side]
            side=5
            team_name=player2
        [/modify_side]

        {VARIABLE steppe_survival_betrayal yes}

        [objectives]
            [objective]
                {TRANSLATE_DESCRIPTION _"Defeat your former ally" _"Убить своего бывшего союзника"}
                condition=win
            [/objective]
            [objective]
                description=_ "Death of your leader"
                condition=lose
            [/objective]

#            [note]
#                description=$notes
#            [/note]
        [/objectives]
        [/then]
        [else]

#ifdef STEPPE_MUSIC
            {REPLACE_SCENARIO_MUSIC journeys_end.ogg}
#else
            {REPLACE_SCENARIO_MUSIC journeys_end.ogg}
#endif

            [message]
                side=4,5
                canrecruit=yes
                {TRANSLATE_MESSAGE _"We did it! The fortress is ours!" _"Воины, мы справились! Крепость наша!"}
            [/message]
        
            [message]
                speaker=narrator
                image=wesnoth-icon.png
                {TRANSLATE_MESSAGE _"Weary from the battle, the soldiers watched from the walls as the remnants of the enemy armies fleв away. Their faces, drenched in blood and sweat, showed slight smiles. Each of them thanked their gods for making it out of this bloodbath alive. The remnants of the army of the fallen commander joined the army of the survivor, and he himself won the laurels of the conqueror of the fortress and received generous rewards from his master." _"Утомлённые битвой, солдаты наблюдали со стен, как бегут прочь остатки армий противника. На их лицах, залитых кровью и потом, появлялись короткие улыбки. Каждый из них благодарил своих богов за то, что пережил эту мясорубку и остался в живых. Остатки армии падшего командира присоединились к войску уцелевшего, а сам он снискал лавры завоевателя крепости и получил щедрые награды от своего повелителя."}
            [/message]
            [endlevel]
                result=victory
            [/endlevel]        
        [/else]
        [/if]
        [/else]
        [/if]
    [/event]

    [event]
        name=last breath
        first_time_only=no
        [filter]
            side=4,5
            canrecruit=yes
        [/filter]
        [filter_second_attack]
        [not]
           special=steppe_enslave
           [or]
           special=steppe_capture
           [/or]
        [/not]
        [/filter_second_attack]

        [if]
        #check if the side has more than one leadeR:
        [not]
        [have_unit]
            side=$unit.side
            canrecruit=yes
            [not]
            id=$unit.id
            [/not]
        [/have_unit]
        [/not]
        [then]

        [if]
        {VARIABLE_CONDITIONAL steppe_survival_betrayal equals yes}
        [then]

        [message]
            side=$second_unit.side
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Ha! The fortress and glory are both mine! " _"Ха! Крепость моя, и вся слава - мне!"}
        [/message]

        [if]
        [have_unit]
            side=$second_unit.side
            gender=female
            canrecruit=yes
        [/have_unit]
        [then]
        [message]
            id=$unit.id
            {TRANSLATE_MESSAGE _"Traitor... I curse you, you will share my fate!" _"Предательница... проклинаю тебя, ты разделишь мою судьбу!"}
        [/message]
        [/then]
        [else]
        [message]
            id=$unit.id
            {TRANSLATE_MESSAGE _"Traitor... I curse you, you will share my fate!" _"Предатель... проклинаю тебя, ты разделишь мою судьбу!"}
        [/message]
        [/else]
        [/if]

        [endlevel]
        [result]
        side=$second_unit.side
        result=victory
        [/result]
        [result]
        side=$unit.side
        result=defeat
        [/result]
        [/endlevel]

        [/then]
        [else]

        {RANDOM 1..2}
        {IF_VAR random equals 2 (
        [then]

        {IF_VAR unit.gender equals female (
        [then]
            [message]
                speaker=unit
                {TRANSLATE_MESSAGE _"I am defeated... my bones will forever remain in this cursed place!" _"Я побеждёна... Мои кости навеки останутся в этом проклятом месте!"}
            [/message]
        [/then]
        [else]
            [message]
                speaker=unit
                {TRANSLATE_MESSAGE _"I am defeated... my bones will forever remain in this cursed place!" _"Я побеждён... Мои кости навеки останутся в этом проклятом месте!"}
            [/message]
        [/else]
        )}

        [/then]
        [else]
            [message]
                speaker=unit
                {TRANSLATE_MESSAGE _"No! Soldiers, hold... the... fortress..." _"Нет! Солдаты, удержите... крепость..."}
            [/message]
        [/else]
        )}


        [if]
            [have_unit]
                side=4,5
                canrecruit=yes
            [/have_unit]
            [then]

            [role]
            role=surviving_leader
            side=4,5
            canrecruit=yes
            [not]
            id=$unit.id
            [/not]
            [/role]

            {IF_VAR unit.gender equals female (
            [then]
            [message]
                role=surviving_leader
                {TRANSLATE_MESSAGE _"The fool allowed herself to be killed... At least I won't have to share the glory with her!" _"Дура позволила себя убить... Ничего, зато не придётся делить с ней славу!"}
            [/message]
            [/then]
            [else]
            [message]
                role=surviving_leader
                {TRANSLATE_MESSAGE _"The fool allowed himself to be killed... At least I won't have to share the glory with him!" _"Дурак позволил себя убить... Ничего, зато не придётся делить с ним славу!"}
            [/message]
            [/else]
            )}

            [/then]
            [else]
                [music]
                    name=defeat.ogg
                    play_once=yes
                    immediate=yes
                [/music]
                [message]
                    speaker=narrator
                    image=wesnoth-icon.png
                    {TRANSLATE_MESSAGE _"Both commanders fell on the battlefield. Their soldiers, scattered and defeated, were killed to the last one. History will not remember their names or their exploits. All that is destined for them is to become ashes in the bonfires of jubilant victors... " _"Оба командира пали на поле боя. Их солдаты, растерянные и подавленные, были перебиты все до одного. История не запомнит ни их имён, ни их подвигов. Всё, что им уготовано - стать пеплом в кострах ликующих победителей..."}
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]

        [/else]
        [/if]

        [/then]
        [/if]
    [/event]

#event for having the leader sold

    [event]
        name=last breath
        first_time_only=no
        [filter]
            side=4,5
            canrecruit=yes
            ability=steppe_captured
        [/filter]

        [if]
        #check if the side has more than one leadeR:
        [not]
        [have_unit]
            side=$unit.variables.origside
            canrecruit=yes
            [not]
            id=$unit.id
            [/not]
        [/have_unit]
        [/not]
        [then]

        [if]
        {VARIABLE_CONDITIONAL steppe_survival_betrayal equals yes}
        [then]

        {IF_VAR unit.gender equals female (
        [then]
        [message]
            side=$second_unit.side
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Inside you were always a slave, groveling before a master. So grovel now forever in the distant, godforsaken lands!" _"Внутри ты всегда была рабыня и пресмыкалася перед господином. Так пресмыкайся теперь вечно в далёких, богом забытых землях!"}
            sound=whip.ogg
        [/message]
        [/then]
        [else]
        [message]
            side=$second_unit.side
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Inside you were always a slave, groveling before a master. So grovel now forever in the distant, godforsaken lands!" _"Внутри ты всегда был рабом и пресмыкался перед господином. Так пресмыкайся теперь вечно в далёких, богом забытых землях!"}
            sound=whip.ogg
        [/message]
        [/else]
        )}

        [message]
            id=$unit.id
            {TRANSLATE_MESSAGE _"Curses! Mark my words, you still hear my name! I will return, I will raise an army, I... " _"Проклятье, ты ещё услышишь моё имя! Я вернусь, я соберу армию, я..."}
        [/message]
        [message]
            side=$second_unit.side
            canrecruit=yes
            {TRANSLATE_MESSAGE _"Sold!" _"Продано!"}
            sound=whip.ogg
        [/message]
        [endlevel]
        [result]
        side=$second_unit.side
        result=victory
        [/result]
        [result]
        side=$unit.side
        result=defeat
        [/result]
        [/endlevel]
        [/then]
        [/if]

        [/then]
        [/if]
    [/event]

#    [event]
#        name=time over
#        [music]
#            name=defeat.ogg
#            play_once=yes
#            immediate=yes
#        [/music]
#        [sound]
#            name=dwarf-laugh.wav
#        [/sound]
#        [message]
#            side=1,2
#            canrecruit=yes
#            message= _ "The enemy cheers as a dark mist rises from the land, engulfing you. As ghostly wisps drain away your will, you realize that your #time in this land is over."
#        [/message]
#    [/event]
#    [options]
#        [slider]
#            id = "enemey_gold_factor"
#            default = 0
#            min = -30
#            max = 30
#            step = 10
#            #textdomain wesnoth-lib
#            name = _ "Difficulty"
#            #textdomain wesnoth-multiplayer
#            description =_  "Changes the gold worth of the enemy spawns by a certain percentage"
#        [/slider]
#    [/options]
[/multiplayer]
